<%= stylesheet_link_tag "/plugin_assets/cwa/stylesheets/appmanager.css" %>
<%= javascript_include_tag "/plugin_assets/cwa/javascript/jquery.cookie.js" %>
<script>
  <%= render :formats => [:js], :partial => 'cwa_browser/browser' %>
</script>

<div style="margin: 18px">
<%= form_tag '/cwa_browser', :id => 'app_form', :multipart => true do %>

<%= hidden_field_tag :selected_item, nil %>
<%= hidden_field_tag :selected_dir, nil %>
<%= hidden_field_tag :selected_file, nil %>
<%= hidden_field_tag :selected_share, @browser.current_share %>

  <div class="actionButtons">
    <!-- Action buttons -->
    <div class="toolButton" style="background-image: url('/plugin_assets/cwa/images/mkdir.svg');" onclick="cwaAction('mkdir','Specify directory name to be created:',false)" title="New Folder..."></div>
    <div class="toolButton" style="background-image: url('/plugin_assets/cwa/images/newfile.svg');" onclick="showTextEditor()"title="Create File..."></div>
    <div class="toolButton" style="background-image: url('/plugin_assets/cwa/images/delete.svg');" onclick="cwaAction('delete',null, true)" title="Delete File..."></div>
    <div class="toolButton" style="background-image: url('/plugin_assets/cwa/images/upload.svg');" onclick="showUploadFile()" title="Upload File..."></div>
    <div class="toolButton" style="background-image: url('/plugin_assets/cwa/images/download.svg');" onclick="cwaAction('download', null, false)" title="Download File..."></div>

    <!-- Current directory window -->
    <div>
      <b>Current Path:</b> <%= text_field_tag :current_dir, "", :size => 72, :disabled => true %>
    </div>
  </div>

<div>
  <div class="box dirSelector" id="dirContainer">
    <p><b>Data Stores</b></p>
    <hr/>
    <ul class="dir">
    <% ([["home",nil,"home.svg"],["work",nil,"netshare.svg"]] + @group_list.map {|g| [ "shares", g[:cn], "netshare.svg"]}).each do |store| %>
      <% id = store[1].nil? ? store[0] + "." : store[0] + "#" + store[1] %>
      <li id="<%= id %>" style="background-image: url('/plugin_assets/cwa/images/<%= store[2] %>'); background-size: 24px;" onclick="collapsibleExpand(this)"><%= store[1].nil? ? store[0] : store[1] %></li>
    <% end %>
    </ul>
  </div>

  <div class="box fileSelector">
  <table class="fileItem">
    <thead>
    <tr>
      <th>Name</th>
      <th>Owner</th>
      <th>Group</th>
      <th>Mode</th>
      <th>Change Time</th>
    </tr>
    </thead>
    <tbody id="fileContainer">
    </tbody>
  </table> 
  </div>
<% end %>
</div>
</div>

<div id="upload">
  <center>
  <%= form_tag "STUB", :id => 'upload_form', :multipart => true do %>
    <b><p>Select file to upload</p></b>
    <p><%= file_field_tag :upload_file %></p>
    <%= submit_tag "Upload", :onclick => "uploadFile()" %><%= button_to_function "Cancel", "hideUploadFile()"%>
  <% end %>
  </center>
</div>

<div id="tail" class="miniapp">
  <center>
  <%= form_tag "/cwa_browser/#{@project.identifier}/tail", :id => 'tail_box' do %>
    <%= text_area_tag :tail_content, nil, { :rows => "28", :cols => "96", :readonly => true } %>
    <br/>
    <%= button_to_function "Close", "hideTail()"%>
  <% end %>
  </center>
</div>

<div id="textEditor" class="miniapp">
  <center>
  <%= form_tag "STUB", :id => 'new_file_form', :multipart => true do %>
    <%= label_tag :new_file_name, "New Text File Name" %>
    <%= hidden_field_tag :dir, @browser.current_dir %>
    <%= text_field_tag :new_file_name, nil, :length => 128 %>
    <br/>
    <%= text_area_tag :new_file_content, nil, { :rows => "28", :cols => "96" } %>
    <br/>
    <%= submit_tag "Create" %><%= button_to_function "Cancel", "hideTextEditor()"%>
  <% end %>
  </center>
</div>

<div id="menuDir" class="menu">
  <div class="menuItem" onclick="cwaAction('download', null, false)">Download as Zip</div>
  <div class="menuItem" onclick="cwaAction('rename','Enter new name for directory:', false)">Rename...</div>
  <div class="menuItem" onclick="cwaAction('delete',null, true)">Delete...</div>
  <div class="menuItem" onclick="showMove()">Move...</div>
</div>

<div id="menuFile" class="menu">
  <div class="menuItem" onclick="cwaAction('download', null, false)">Download</div>
  <div class="menuItem" onclick="showTail()">Tail...</div>
  <div class="menuItem" onclick="cwaAction('rename', 'Enter new name for file:', false)">Rename...</div>
  <div class="menuItem" onclick="cwaAction('delete',null, true)">Delete...</div>
  <div class="menuItem" onclick="showMove()">Move...</div>
</div>

<script>
  document.getElementById('home.').click();
</script>
